<!-- REPLACE WHOLE FILE: /index.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Cửa hàng liên kết</title>
  <meta name="description" content="Cửa hàng liên kết chuẩn MXD: Danh mục nổi bật và Sản phẩm nổi bật, GA4 trước affiliate, canonical tuyệt đối, SW tối ưu cache."/>
  <link rel="canonical" href="https://tuyetlethi83a.github.io/"/>
  <meta name="robots" content="index,follow"/>

  <meta property="og:title" content="Cửa hàng liên kết"/>
  <meta property="og:description" content="Danh mục nổi bật + Sản phẩm nổi bật từ affiliates.json"/>
  <meta property="og:url" content="https://tuyetlethi83a.github.io/"/>
  <meta property="og:image" content="https://tuyetlethi83a.github.io/assets/og/default-og.webp"/>

  <!-- Palette nhẹ (override site.css nếu cần) -->
  <style>
    :root{
      --brand:#0b3b5b; --accent:#00bfa6; --cta:#ff6b00;
      --text:#111827; --muted:#6b7280; --bg:#fff;
      --hero-text:#fff;
    }
    .hero{background:var(--brand); color:var(--hero-text);}
    .badge{background:var(--accent); color:#fff; border-radius:999px; padding:.15rem .5rem; display:inline-block}
  </style>

  <link rel="stylesheet" href="/assets/site.css"/>
  <!-- GA4 trước affiliate -->
  <script defer src="/assets/analytics.js"></script>
  <script defer src="/assets/mxd-affiliate.js"></script>

  <!-- JSON-LD Organization -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Organization","name":"MXD","url":"https://tuyetlethi83a.github.io/","logo":"https://tuyetlethi83a.github.io/assets/og/default-og.webp","sameAs":["https://facebook.com/lethituyet.le.3"]}
  </script>
</head>
<body>

<!-- NAV -->
<header class="topbar">
  <div class="container nav">
    <a class="brand" href="/">Cửa hàng liên kết</a>
    <nav>
      <a href="/">Trang chủ</a>
      <a href="/store.html">Cửa hàng</a>
      <a href="/store/thoi-trang.html">Thời trang</a>
      <a href="/store/my-pham.html">Mỹ phẩm</a>
      <a href="/store/me-va-be.html">Mẹ & Bé</a>
      <a href="/lien-he.html">Liên hệ</a>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>Cửa hàng liên kết</h1>
    <p class="muted">GA4 trước affiliate • Canonical tuyệt đối • SW bật sẵn</p>
    <div class="actions">
      <a class="btn" href="/store.html">Vào Cửa hàng</a>
      <a class="btn outline" href="/g.html?sku=ao-croptop-ba-lo-nu-toptify">Xem trang sản phẩm (demo)</a>
    </div>
  </div>
</section>

<main>
  <!-- Danh mục nổi bật -->
  <section class="container">
    <h2>Danh mục nổi bật</h2>
    <ul class="category-grid">
      <li><a class="category-tile" href="/store/thoi-trang.html">
        <img src="/assets/img/categories/thoi-trang.webp" alt="Thời trang — MXD" width="400" height="240"/>
        <span>Thời trang</span></a></li>
      <li><a class="category-tile" href="/store/my-pham.html">
        <img src="/assets/img/categories/my-pham.webp" alt="Mỹ phẩm — MXD" width="400" height="240"/>
        <span>Mỹ phẩm</span></a></li>
      <li><a class="category-tile" href="/store/me-va-be.html">
        <img src="/assets/img/categories/me-va-be.webp" alt="Mẹ & Bé — MXD" width="400" height="240"/>
        <span>Mẹ & Bé</span></a></li>
    </ul>
    <p style="margin-top:1rem"><a class="btn" href="/store.html">Xem tất cả danh mục</a></p>
  </section>

  <!-- Sản phẩm nổi bật -->
  <section class="container">
    <h2>Sản phẩm nổi bật</h2>
    <div id="featured" class="product-grid"><p>Đang tải…</p></div>
    <p style="margin-top:1rem"><a class="btn" href="/store.html">Xem thêm sản phẩm</a></p>
  </section>
</main>

<footer>
  <div class="container"><small class="muted">© 2025 — MXD Canonical.</small></div>
</footer>

<!-- Nút nổi liên hệ -->
<div class="floating-contacts">
  <a class="btn" href="https://zalo.me/0979527398">Zalo</a>
  <a class="btn" href="https://facebook.com/lethituyet.le.3" target="_blank" rel="noopener">Facebook</a>
  <a class="btn" href="tel:0979527398">Gọi 0979527398</a>
</div>

<script>
  /* FIND: index loader v2025-10-31 — tries /assets/data/affiliates.json then /affiliates.json */
  function priceText(v){ const n=Number(v); return Number.isFinite(n)? n.toLocaleString('vi-VN')+' ₫' : ''; }
  function imgPath(p){ return p.image || ('/assets/img/products/'+p.sku+'.webp'); }
  function card(p){
    const origin = p.origin_url ?? p.origin ?? '#';
    const priceRaw = p.price_vnd ?? p.price;
    const price = priceText(priceRaw);
    return `
      <div class="card product-card">
        <a class="product-meta" href="${origin}"
           data-merchant="${(p.merchant||'')}"
           data-sku="${p.sku}"
           data-img="${imgPath(p)}"
           ${Number.isFinite(Number(priceRaw))?`data-price="${Number(priceRaw)}"`:''}>${p.name}</a>
        <img src="${imgPath(p)}" alt="${p.name}"/>
        ${price?`<p><strong>${price}</strong></p>`:''}
        <p><span class="badge">${p.merchant||''}</span></p>
        <p><a class="btn buy" href="#">Mua ngay</a></p>
      </div>`;
  }

  async function loadAffiliates(){
    const candidates = ['/assets/data/affiliates.json','/affiliates.json'];
    for(const url of candidates){
      try{
        const r = await fetch(url,{cache:'no-store'});
        if(r.ok) return await r.json();
      }catch(e){}
    }
    return [];
  }

  (async () => {
    try{
      const list = await loadAffiliates();
      const preferred = ['thoi-trang','my-pham','me-va-be'];
      const scored = list.map(p=>{
        const c=(p.category||'').toLowerCase();
        const score = preferred.findIndex(x=>c.startsWith(x));
        return {p, score: score===-1? 9 : score};
      }).sort((a,b)=>a.score-b.score);
      const items = scored.slice(0,12).map(x=>x.p);
      document.getElementById('featured').innerHTML = items.length ? items.map(card).join('') : '<p>Chưa có sản phẩm.</p>';

      // ItemList JSON-LD
      const itemList = {
        "@context":"https://schema.org","@type":"ItemList",
        "itemListElement":items.map((p,i)=>({
          "@type":"ListItem","position":i+1,
          "url":new URL('/g.html?sku='+encodeURIComponent(p.sku),location.origin).href
        }))
      };
      const s=document.createElement('script'); s.type='application/ld+json'; s.textContent=JSON.stringify(itemList); document.head.appendChild(s);
    }catch(e){
      document.getElementById('featured').innerHTML = '<p>Lỗi tải dữ liệu.</p>';
    }
  })();

  // MXD-CHECK: SW register
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(()=>{});
  }
</script>
</body>
</html>
