const VERSION='2025-10-31-a',ASSET_CACHE='mxd-assets-'+VERSION;self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>!k.endsWith(VERSION)&&k.startsWith('mxd-assets-')).map(k=>caches.delete(k)))));self.clients.claim()});self.addEventListener('fetch',e=>{const r=e.request,u=new URL(r.url);if(r.method!=='GET')return;if(r.mode==='navigate'){e.respondWith(fetch(r).catch(()=>caches.match('/')));return}if(/\.(?:css|js|png|jpg|jpeg|webp|svg|json|webmanifest)$/i.test(u.pathname)){e.respondWith((async()=>{const c=await caches.open(ASSET_CACHE);const d=await c.match(r);const f=fetch(r).then(n=>{c.put(r,n.clone());return n}).catch(()=>null);return d||f||fetch(r)})())}})